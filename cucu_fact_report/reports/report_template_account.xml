<?xml version="1.0" encoding="UTF-8"?>
<odoo>

  <!-- ============================================================
       1) TEMPLATE WRAPPER
       Este es el template que llama ir.actions.report
       NO hereda, SOLO renderiza el estándar
       ============================================================ -->
  <template id="cucu_report_account" name="CUCU - Factura (Wrapper estándar)">
    <t t-call="web.html_container">
      <t t-foreach="docs" t-as="o">
        <!-- Idioma como Odoo estándar -->
        <t t-set="lang" t-value="o.partner_id.lang or o.env.user.lang"/>
        <t t-set="o" t-value="o.with_context(lang=lang)"/>

        <!-- Flags usados por el template oficial -->
        <t t-set="proforma" t-value="data.get('proforma') if data else False"/>
        <t t-set="print_with_payments" t-value="data.get('print_with_payments') if data else False"/>

        <!-- Render EXACTO del reporte oficial -->
        <t t-call="account.report_invoice_document"/>
      </t>
    </t>
  </template>


  <!-- ============================================================
       2) FIX DE TÍTULO
       Heredamos SOLO para corregir el espacio "Factura  AG.RI/..."
       ============================================================ -->
  <template id="cucu_invoice_title_fix"
            inherit_id="account.report_invoice_document">

    <xpath expr="//t[@t-set='layout_document_title']" position="replace">
      <t t-set="layout_document_title">
        <!-- PROFORMA -->
        <t t-if="proforma">
          <span>PROFORMA</span>
        </t>

        <!-- FACTURA / OTROS ESTADOS -->
        <t t-else="">
          <t t-if="o.move_type == 'out_invoice' and o.state == 'posted'">
            <span>Factura</span>
          </t>
          <t t-elif="o.move_type == 'out_invoice' and o.state == 'draft'">
            <span>Borrador de factura</span>
          </t>
          <t t-elif="o.move_type == 'out_invoice' and o.state == 'cancel'">
            <span>Factura cancelada</span>
          </t>
          <t t-elif="o.move_type == 'out_refund' and o.state == 'posted'">
            <span>Factura rectificativa</span>
          </t>
          <t t-elif="o.move_type == 'out_refund' and o.state == 'draft'">
            <span>Borrador de factura rectificativa</span>
          </t>
          <t t-elif="o.move_type == 'out_refund' and o.state == 'cancel'">
            <span>Factura rectificativa cancelada</span>
          </t>
          <t t-elif="o.move_type == 'in_refund'">
            <span>Factura rectificativa de proveedor</span>
          </t>
          <t t-elif="o.move_type == 'in_invoice'">
            <span>Factura de proveedor</span>
          </t>
          <t t-else="">
            <span>Factura</span>
          </t>
        </t>

        <!-- Número: sin salto raro -->
        <t t-if="o.name and o.name != '/'">
          <span style="margin-left:6px;" t-field="o.name"/>
        </t>
      </t>
    </xpath>

  </template>

</odoo>

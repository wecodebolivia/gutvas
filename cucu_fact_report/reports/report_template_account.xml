<?xml version="1.0" encoding="UTF-8"?>
<odoo>

  <!-- =========================================================
       TEMPLATE PRINCIPAL – FACTURA / PROFORMA
       Sin herencia, sin helpers externos (Odoo 18 safe)
       ========================================================= -->
  <template id="cucu_report_account">

    <t t-call="web.basic_layout">
      <t t-foreach="docs" t-as="o">

        <div class="page">

          <!-- ================= ENCABEZADO ================= -->
          <h2 style="margin-bottom:10px;">
            Factura
          </h2>

          <table class="table table-sm">
            <tr>
              <td><strong>Cliente:</strong></td>
              <td><span t-esc="o.partner_id.name"/></td>
            </tr>
            <tr>
              <td><strong>Fecha:</strong></td>
              <td><span t-esc="o.invoice_date"/></td>
            </tr>
            <tr>
              <td><strong>Número:</strong></td>
              <td><span t-esc="o.name"/></td>
            </tr>
          </table>

          <!-- ================= DETALLE ================= -->
          <table class="table table-sm table-bordered" style="margin-top:15px;">
            <thead>
              <tr>
                <th>Producto</th>
                <th class="text-right">Cantidad</th>
                <th class="text-right">Precio</th>
                <th class="text-right">Subtotal</th>
              </tr>
            </thead>
            <tbody>
              <t t-foreach="o.invoice_line_ids" t-as="l">
                <tr>
                  <td>
                    <span t-esc="l.name"/>
                  </td>
                  <td class="text-right">
                    <span t-esc="l.quantity"/>
                  </td>
                  <td class="text-right">
                    <t t-set="cur" t-value="o.currency_id"/>
                    <t t-set="price" t-value="round(l.price_unit or 0.0, 2)"/>
                    <t t-if="cur.position == 'after'">
                      <span t-esc="('%0.2f' % price)"/> <span t-esc="cur.symbol or ''"/>
                    </t>
                    <t t-else="">
                      <span t-esc="cur.symbol or ''"/> <span t-esc="('%0.2f' % price)"/>
                    </t>
                  </td>
                  <td class="text-right">
                    <t t-set="subtotal" t-value="round(l.price_subtotal or 0.0, 2)"/>
                    <t t-if="cur.position == 'after'">
                      <span t-esc="('%0.2f' % subtotal)"/> <span t-esc="cur.symbol or ''"/>
                    </t>
                    <t t-else="">
                      <span t-esc="cur.symbol or ''"/> <span t-esc="('%0.2f' % subtotal)"/>
                    </t>
                  </td>
                </tr>
              </t>
            </tbody>
          </table>

          <!-- ================= TOTALES ================= -->
          <table class="table table-sm" style="margin-top:15px; width:40%; float:right;">
            <tr>
              <td><strong>Total:</strong></td>
              <td class="text-right">
                <t t-set="cur" t-value="o.currency_id"/>
                <t t-set="amt" t-value="round(o.amount_total or 0.0, 2)"/>
                <t t-if="cur.position == 'after'">
                  <span t-esc="('%0.2f' % amt)"/> <span t-esc="cur.symbol or ''"/>
                </t>
                <t t-else="">
                  <span t-esc="cur.symbol or ''"/> <span t-esc="('%0.2f' % amt)"/>
                </t>
              </td>
            </tr>
          </table>

        </div>

      </t>
    </t>

  </template>

</odoo>
